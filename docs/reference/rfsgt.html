<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Random Forest Super Greedy Trees — rfsgt • Random Forest Super Greedy Trees</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Random Forest Super Greedy Trees — rfsgt"><meta property="og:description" content="Grow a forest of Super Greedy Trees (SGTs) using lasso."><meta property="og:image" content="https://www.randomforestsgt.org/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-WZWXVK817Z"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZWXVK817Z');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Random Forest Super Greedy Trees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.63</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/getstarted.html">
    <span class="fas fa-home fa-lg"></span>

    Getting Started
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../reference/index.html">Manual</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSGT/issues" class="external-link">Bug Reporting</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSGT/discussions" class="external-link">Discussions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSGT/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kogalur/randomForestSGT/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Random Forest Super Greedy Trees</h1>

    <div class="hidden name"><code>rfsgt.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Grow a forest of Super Greedy Trees (SGTs) using lasso.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">formula</span>,</span>
<span>      <span class="va">data</span>,</span>
<span>      ntree <span class="op">=</span> <span class="fl">100</span>,</span>
<span>      hcut <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      treesize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      nodesize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      tune.treesize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      filter <span class="op">=</span> <span class="op">(</span><span class="va">hcut</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      keep.only <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      fast <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      pure.lasso <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      eps <span class="op">=</span> <span class="fl">.005</span>,</span>
<span>      maxit <span class="op">=</span> <span class="fl">500</span>,</span>
<span>      nfolds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      block.size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      bootstrap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"by.root"</span>, <span class="st">"none"</span>, <span class="st">"by.user"</span><span class="op">)</span>,</span>
<span>      samptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"swor"</span>, <span class="st">"swr"</span><span class="op">)</span>,  samp <span class="op">=</span> <span class="cn">NULL</span>, membership <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      sampsize <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">samptype</span> <span class="op">==</span> <span class="st">"swor"</span><span class="op">)</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op">*</span> <span class="fl">.632</span><span class="op">}</span> <span class="kw">else</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">}</span>,</span>
<span>      seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      do.trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<p></p>
<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Formula describing the model to be fit.</p></dd>


  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame containing response and features.</p></dd>


  <dt id="arg-ntree">ntree<a class="anchor" aria-label="anchor" href="#arg-ntree"></a></dt>
<dd><p>Number of trees to grow.</p></dd>


  <dt id="arg-hcut">hcut<a class="anchor" aria-label="anchor" href="#arg-hcut"></a></dt>
<dd><p>Integer value indexing type of parametric regression model
    to use for splitting.  See details below.</p></dd>


  <dt id="arg-treesize">treesize<a class="anchor" aria-label="anchor" href="#arg-treesize"></a></dt>
<dd><p>Function specifying size of tree (number of terminal
    nodes) where first input is <code>n</code> sample size and second input is
    <code>hcut</code>.  Can also be supplied as an integer value and defaults
    to an internal function if unspecified.  If
    <code>tune.treesize</code>=TRUE, this is the maximum number of allowable
    splits.  If <code>tune.treesize</code>=FALSE, this is the target number of
    tree splits.</p></dd>


  <dt id="arg-nodesize">nodesize<a class="anchor" aria-label="anchor" href="#arg-nodesize"></a></dt>
<dd><p>Minumum size of terminal node.  Set internally if
    not specified.</p></dd>


  <dt id="arg-tune-treesize">tune.treesize<a class="anchor" aria-label="anchor" href="#arg-tune-treesize"></a></dt>
<dd><p>Adaptively determine the optimal tree size using
    out-of-bag empirical risk?</p></dd>


  <dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>Logical value specifying whether dimension reduction
    (filtering) of features should be performed.Can also be specified
    using the helper function <code>tune.hcut</code> which performs dimension
    reduction prior to fitting.  See examples below.</p></dd>


  <dt id="arg-keep-only">keep.only<a class="anchor" aria-label="anchor" href="#arg-keep-only"></a></dt>
<dd><p>Character vector specifying the features of interest.
  The data is pre-filtered to keep only these requested variables.
  Ignored if filter is specified using <code>tune.hcut</code>.</p></dd>


  <dt id="arg-fast">fast<a class="anchor" aria-label="anchor" href="#arg-fast"></a></dt>
<dd><p>Use fast filtering?</p></dd>


  <dt id="arg-pure-lasso">pure.lasso<a class="anchor" aria-label="anchor" href="#arg-pure-lasso"></a></dt>
<dd><p>Logical value specifying whether lasso splitting
  should be strictly adhered to.  In general, lasso splits are replaced
  with CART whenever numerical instability occurs (for example, small
  node sample sizes may make it impossible to obtain the cross-validated
  lasso parameter).  This option will generally produce shallow trees which
  not be appropriate in all settings.</p></dd>


  <dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>Parameter used by <code>cdlasso</code>.</p></dd>


  <dt id="arg-maxit">maxit<a class="anchor" aria-label="anchor" href="#arg-maxit"></a></dt>
<dd><p>Parameter used by <code>cdlasso</code>.</p></dd>


  <dt id="arg-nfolds">nfolds<a class="anchor" aria-label="anchor" href="#arg-nfolds"></a></dt>
<dd><p>Number of cross-validation folds to be used for the lasso.</p></dd>


  <dt id="arg-block-size">block.size<a class="anchor" aria-label="anchor" href="#arg-block-size"></a></dt>
<dd><p>Determines how cumulative error rate is calculated.  To
    obtain the cumulative error rate on every nth tree, set the value to
    an integer between 1 and <code>ntree</code>.</p></dd>


  <dt id="arg-bootstrap">bootstrap<a class="anchor" aria-label="anchor" href="#arg-bootstrap"></a></dt>
<dd><p>Bootstrap protocol.  Default is <code>by.root</code> which
    bootstraps the data by sampling with or without replacement (without
    replacement is the default; see the option <code>samptype</code> below).
    If <code>none</code>, the data is not bootstrapped (it is not possible to
    return OOB ensembles or prediction error in this case).  If
    <code>by.user</code>, the bootstrap specified by <code>samp</code> is used.</p></dd>


  <dt id="arg-samptype">samptype<a class="anchor" aria-label="anchor" href="#arg-samptype"></a></dt>
<dd><p>Type of bootstrap used when <code>by.root</code> is in
    effect.  Choices are <code>swor</code> (sampling without replacement;
    the default) and <code>swr</code> (sampling with replacement).</p></dd>


  <dt id="arg-samp">samp<a class="anchor" aria-label="anchor" href="#arg-samp"></a></dt>
<dd><p>Bootstrap specification when <code>by.user</code> is in
    effect.  Array of dim <code>n x ntree</code> specifying how many
    times each record appears inbag in the bootstrap for each tree.</p></dd>


  <dt id="arg-membership">membership<a class="anchor" aria-label="anchor" href="#arg-membership"></a></dt>
<dd><p>Should terminal node membership and inbag
    information be returned?</p></dd>


  <dt id="arg-sampsize">sampsize<a class="anchor" aria-label="anchor" href="#arg-sampsize"></a></dt>
<dd><p>Function specifying bootstrap size when <code>by.root</code>
    is in effect.  For sampling without replacement, it is the requested
    size of the sample, which by default is .632 times the sample size.
    For sampling with replacement, it is the sample size.  Can also be
    specified using a number.</p></dd>


  <dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Negative integer specifying seed for the random number
    generator.</p></dd>


  <dt id="arg-do-trace">do.trace<a class="anchor" aria-label="anchor" href="#arg-do-trace"></a></dt>
<dd><p>Number of seconds between updates to the user on
    approximate time to completion.</p></dd>


  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to <code class="command">cdlasso</code> and
    <code class="command">rfsrc</code>.</p></dd>



</dl></div>
    <div id="details">
    <h2>Details</h2>


<p>A flexible class of parametric models are used for tree splitting
  using lasso.  This includes CART splits, hyperplane, ellipsoid and
  hyperboloid cuts.  Coordinate descent is used for fast calculation of
  the penalized lasso parametric models.  Cross-validation is employed
  to obtain the lasso regularization parameter.</p>
<p>These trees are called super greedy trees (SGTs) and are constructed
  using best split first (BSF) where cuts are made sequentially in order
  of greatest empirical risk reduction.</p>
<p>Parametric linear models used for splitting are indexed by parameter
  <code>hcut</code> corresponding to the following geometric regions:</p>
<ol><li><p><code>hcut</code>=1 (hyperplane) linear model using all variables.</p></li>
<li><p><code>hcut</code>=2 (ellipse) plus all quadratic terms.</p></li>
<li><p><code>hcut</code>=3 (oblique ellipse) plus all pairwise interactions.</p></li>
<li><p><code>hcut</code>=4 plus all polynomials of degree 3 of two variables.</p></li>
<li><p><code>hcut</code>=5 plus all polynomials of degree 4 of three variables.</p></li>
<li><p><code>hcut</code>=6 plus all three-way interactions.</p></li>
<li><p><code>hcut</code>=7 plus all four-way interactions.</p></li>
</ol><p>Setting <code>hcut</code>=0 gives CART splits where cuts are parallel to the
 coordinate axis (axis-aligned cuts).  Thus, <code>hcut</code>=0 is similar to
 random forests.</p>
    </div>
    <div id="value">
    <h2>Value</h2>


<p>A forest of SGTs trained on the learning data which can be used for
  prediction.</p>
    </div>
    <div id="author">
    <h2>Author</h2>


<p>Hemant Ishwaran and Udaya B. Kogalur</p>
    </div>
    <div id="references">
    <h2>References</h2>


<p>Ishwaran H. (2023).  Super greedy regression trees with coordinate descent.
  Technical Report.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">

<p><code class="command"><a href="cdlasso.rfsgt.html">cdlasso</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># \donttest{</span></span>
<span>  </span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##  boston housing</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## default basic call</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">BostonHousing</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## variable selection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu">vimp.rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>,<span class="va">BostonHousing</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## examples of hcut=0 (similar to random forests ... but using BSF)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">BostonHousing</span>, hcut<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">BostonHousing</span>, hcut<span class="op">=</span><span class="fl">0</span>, nodesize<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## hcut=1 with smaller nodesize</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">BostonHousing</span>, nodesize<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## boston housing with factors</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span>     </span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span>     </span>
<span><span class="co">## make some features into factors</span></span>
<span><span class="va">Boston</span> <span class="op">&lt;-</span> <span class="va">BostonHousing</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">zn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">zn</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">chas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">chas</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">lstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.2</span> <span class="op">*</span> <span class="va">Boston</span><span class="op">$</span><span class="va">lstat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">nox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">20</span> <span class="op">*</span> <span class="va">Boston</span><span class="op">$</span><span class="va">nox</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">rm</span><span class="op">)</span><span class="op">)</span></span>
<span>     </span>
<span><span class="co">## random forest: hcut=0 </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">Boston</span>, hcut<span class="op">=</span><span class="fl">0</span>, nodesize<span class="op">=</span><span class="fl">1</span>, ntree<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## hcut=3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">Boston</span>, hcut<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##  ozone</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Ozone</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">V4</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span>, hcut<span class="op">=</span><span class="fl">0</span>, nodesize<span class="op">=</span><span class="fl">1</span>, ntree<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">V4</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span>, hcut<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">V4</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span>, hcut<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">V4</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span>, hcut<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##  non-linear boundary illustrates hcut using single tree</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## simulate non-linear boundary</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">signal</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">treesize</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">ngrid</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co">## train</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">fx</span> <span class="op">&lt;-</span> <span class="va">signal</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">nl2d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">fx</span>, <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## truth</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="va">ngrid</span><span class="op">)</span></span>
<span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="va">signal</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x1</span>, <span class="va">x2</span>, <span class="st">"*"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## test</span></span>
<span><span class="va">x.tst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x1j</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1j</span>, <span class="va">x2</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, ncol<span class="op">=</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x.tst</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">fx.tst</span> <span class="op">&lt;-</span> <span class="va">signal</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x.tst</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x.tst</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">nl2d.tst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">fx.tst</span>, <span class="va">x.tst</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## SGT for different hcut values</span></span>
<span><span class="va">rO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">hcut</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"hcut"</span>, <span class="va">hcut</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">nl2d</span>, ntree<span class="op">=</span><span class="fl">1</span>, hcut<span class="op">=</span><span class="va">hcut</span>, treesize<span class="op">=</span><span class="va">treesize</span>, bootstrap<span class="op">=</span><span class="st">"none"</span>,</span>
<span>         tune.treesize<span class="op">=</span><span class="cn">TRUE</span>, nodesize<span class="op">=</span><span class="fl">1</span>, strikeout<span class="op">=</span><span class="fl">10000</span>, filter<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## nice little wrapper for plotting results</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"interp"</span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## nice little wrapper for plotting results</span></span>
<span>  <span class="va">plot.image</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, <span class="va">linear</span><span class="op">=</span><span class="cn">TRUE</span>, <span class="va">nlevels</span><span class="op">=</span><span class="fl">40</span>, <span class="va">points</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">xo</span> <span class="op">&lt;-</span> <span class="va">x</span>; <span class="va">yo</span> <span class="op">&lt;-</span> <span class="va">y</span></span>
<span>    <span class="va">so</span> <span class="op">&lt;-</span> <span class="fu">interp</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, z<span class="op">=</span><span class="va">z</span>, linear<span class="op">=</span><span class="va">linear</span>, nx<span class="op">=</span><span class="va">nlevels</span>, ny<span class="op">=</span><span class="va">nlevels</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">so</span><span class="op">$</span><span class="va">x</span>; <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">so</span><span class="op">$</span><span class="va">y</span>; <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">so</span><span class="op">$</span><span class="va">z</span></span>
<span>    <span class="va">xlim</span> <span class="op">&lt;-</span> <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, finite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">z</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="va">zlim</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.01</span>, <span class="fl">.99</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>    <span class="va">z</span><span class="op">[</span><span class="va">z</span><span class="op">&lt;=</span><span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">z</span><span class="op">[</span><span class="va">z</span><span class="op">&gt;=</span><span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/pretty.html" class="external-link">pretty</a></span><span class="op">(</span><span class="va">zlim</span>, <span class="va">nlevels</span><span class="op">)</span></span>
<span>    <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">levels</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, <span class="st">"YlOrRd"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span><span class="va">xlim</span>, <span class="va">ylim</span>, <span class="st">""</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, asp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/filled.contour.html" class="external-link">.filled.contour</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, <span class="va">levels</span>, <span class="va">col</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">points</span><span class="op">)</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xo</span>,<span class="va">yo</span> ,pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">.25</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">truth</span>, xlab<span class="op">=</span><span class="st">""</span>, ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">truth</span>, nlevels <span class="op">=</span> <span class="fl">15</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, drawlabels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fl">1</span>,line<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,<span class="fl">2</span>,line<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"truth"</span><span class="op">)</span>,<span class="fl">3</span>,line<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">plot.image</span><span class="op">(</span><span class="va">nl2d.tst</span><span class="op">[</span>,<span class="st">"X1"</span><span class="op">]</span>,<span class="va">nl2d.tst</span><span class="op">[</span>,<span class="st">"X2"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rO</span><span class="op">[[</span><span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">nl2d.tst</span><span class="op">)</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">truth</span>, nlevels <span class="op">=</span> <span class="fl">15</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, drawlabels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fl">1</span>,line<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,<span class="fl">2</span>,line<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"hcut="</span>,<span class="va">j</span><span class="op">)</span>,<span class="fl">3</span>,line<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##  friedman illustration of OOB empirical risk</span></span>
<span><span class="co">##  (note: tune.treesize=TRUE required to obtain empirical risk)</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## simulate friedman</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman1.html" class="external-link">mlbench.friedman1</a></span><span class="op">(</span><span class="va">n</span>, sd<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## rf versus rfsgt</span></span>
<span><span class="va">o1</span> <span class="op">&lt;-</span> <span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">dta</span>, hcut<span class="op">=</span><span class="fl">0</span>, tune.treesize<span class="op">=</span><span class="cn">TRUE</span>, block.size<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">o2</span> <span class="op">&lt;-</span> <span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">dta</span>, hcut<span class="op">=</span><span class="fl">3</span>, tune.treesize<span class="op">=</span><span class="cn">TRUE</span>, block.size<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## compute running average of OOB empirical risk</span></span>
<span><span class="va">runavg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">lag</span> <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">lag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lag</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">cx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rx</span> <span class="op">&lt;-</span> <span class="va">cx</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">lag</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">lag</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rx</span>, <span class="op">(</span><span class="va">cx</span><span class="op">[</span><span class="op">(</span><span class="va">lag</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cx</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">cx</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cx</span><span class="op">)</span> <span class="op">-</span> <span class="va">lag</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">lag</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">risk1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">o1</span><span class="op">$</span><span class="va">oob.empr.risk</span><span class="op">)</span>, <span class="va">runavg</span><span class="op">)</span></span>
<span><span class="va">leaf1</span> <span class="op">&lt;-</span> <span class="va">o1</span><span class="op">$</span><span class="va">forest</span><span class="op">$</span><span class="va">leafCount</span></span>
<span><span class="va">risk2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">o2</span><span class="op">$</span><span class="va">oob.empr.risk</span><span class="op">)</span>,  <span class="va">runavg</span><span class="op">)</span></span>
<span><span class="va">leaf2</span> <span class="op">&lt;-</span> <span class="va">o2</span><span class="op">$</span><span class="va">forest</span><span class="op">$</span><span class="va">leafCount</span></span>
<span></span>
<span><span class="co">## compare OOB empirical tree risk to OOB forest error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">leaf1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">risk1</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"n"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Tree size"</span>, ylab<span class="op">=</span><span class="st">"RF OOB empirical risk"</span><span class="op">)</span></span>
<span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">risk1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rsk</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">rsk</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rsk</span><span class="op">)</span>, <span class="va">rsk</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">l1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">l1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">leaf2</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">risk2</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"n"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Tree size"</span>, ylab<span class="op">=</span><span class="st">"SGF OOB empirical risk"</span><span class="op">)</span></span>
<span><span class="va">l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">risk2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rsk</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">rsk</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rsk</span><span class="op">)</span>, <span class="va">rsk</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">l2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">l2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">o1</span><span class="op">$</span><span class="va">ntree</span>, <span class="va">o1</span><span class="op">$</span><span class="va">err.rate</span>, type<span class="op">=</span><span class="st">"s"</span>, xlab<span class="op">=</span><span class="st">"Trees"</span>, ylab<span class="op">=</span><span class="st">"RF OOB error"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">o2</span><span class="op">$</span><span class="va">ntree</span>, <span class="va">o2</span><span class="op">$</span><span class="va">err.rate</span>, type<span class="op">=</span><span class="st">"s"</span>, xlab<span class="op">=</span><span class="st">"Trees"</span>, ylab<span class="op">=</span><span class="st">"SGF OOB error"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## synthetic regression examples with different hcut</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## simulation functions</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     friedman1<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman1.html" class="external-link">mlbench.friedman1</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>     friedman2<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman2.html" class="external-link">mlbench.friedman2</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>     friedman3<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman3.html" class="external-link">mlbench.friedman3</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>     peak<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.peak.html" class="external-link">mlbench.peak</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,       </span>
<span>     linear<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">sd</span><span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span></span>
<span>           <span class="va">y</span><span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="fl">3</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>,sd<span class="op">=</span><span class="va">sd</span><span class="op">)</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,<span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## run rfsgt on the simulations</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">max.hcut</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"simulation:"</span>, <span class="va">nm</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">rO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">max.hcut</span>, <span class="kw">function</span><span class="op">(</span><span class="va">hcut</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"     hcut:"</span>, <span class="va">hcut</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>   <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">d</span>,hcut<span class="op">=</span><span class="va">hcut</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hcut</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">o</span><span class="op">$</span><span class="va">err.rate</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">o</span><span class="op">$</span><span class="va">err.rate</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">o</span><span class="op">$</span><span class="va">yvar</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rO</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hcut"</span>, <span class="st">"mse"</span>, <span class="st">"smse"</span><span class="op">)</span></span>
<span>  <span class="va">rO</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## iowa housing data </span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">housing</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## remove PID </span></span>
<span><span class="va">housing</span><span class="op">$</span><span class="va">PID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co">## rough missing data imputation</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">randomForestSRC</span><span class="fu">:::</span><span class="fu">get.na.roughfix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">housing</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">SalePrice</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">SalePrice</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">SalePrice</span><span class="op">~</span><span class="va">.</span>,<span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## high-dimensional model with variable selection</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## simulate big p small n data</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## we have a big p small n pure noise setting: let's see how well we do</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"variables selected by vimp.rfsgt:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu">vimp.rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## internal filtering function can also be used</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"variables selected by filter.rfsgt:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">filter.rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">d</span>, method<span class="op">=</span><span class="st">"conserve"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## pre-filtering using keep.only</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## simulate the data</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, ncol<span class="op">=</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman1.html" class="external-link">mlbench.friedman1</a></span><span class="op">(</span><span class="va">n</span>, sd<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, noise<span class="op">=</span><span class="va">noise</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## filter the variables</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">filter.rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">dta</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## use keep.only to pre-filter the features</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, keep.only<span class="op">=</span><span class="va">f</span>, hcut<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, keep.only<span class="op">=</span><span class="va">f</span>, hcut<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, keep.only<span class="op">=</span><span class="va">f</span>, hcut<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## tuning hcut and pre-filtering using tune.hcut</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## simulate the data</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, ncol<span class="op">=</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman1.html" class="external-link">mlbench.friedman1</a></span><span class="op">(</span><span class="va">n</span>, sd<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, noise<span class="op">=</span><span class="va">noise</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## tune hcut</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">tune.hcut</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">dta</span>, hcut<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## use the optimized hcut</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, filter<span class="op">=</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## over-ride the tuned hcut value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, filter<span class="op">=</span><span class="fu">use.tune.hcut</span><span class="op">(</span><span class="va">f</span>, hcut<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, filter<span class="op">=</span><span class="fu">use.tune.hcut</span><span class="op">(</span><span class="va">f</span>, hcut<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfsgt</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,<span class="va">dta</span>, filter<span class="op">=</span><span class="fu">use.tune.hcut</span><span class="op">(</span><span class="va">f</span>, hcut<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># }</span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.luminwin.net" class="external-link">Min Lu</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

